{"version":3,"file":"asset-ignore.js","sourceRoot":"","sources":["../../../src/cli/utilities/asset-ignore.ts"],"names":[],"mappings":"AAAA,OAAO,EAAC,UAAU,EAAE,QAAQ,EAAC,MAAM,0BAA0B,CAAA;AAC7D,OAAO,EAAC,WAAW,EAAC,MAAM,8BAA8B,CAAA;AACxD,OAAO,EAAC,QAAQ,EAAC,MAAM,4BAA4B,CAAA;AAGnD,MAAM,cAAc,GAAG,gBAAgB,CAAA;AAEvC,MAAM,CAAC,KAAK,UAAU,kBAAkB,CACtC,cAA0B,EAC1B,eAAgC,EAChC,UAAgD,EAAE;IAElD,MAAM,aAAa,GAAG,MAAM,sBAAsB,CAAC,eAAe,CAAC,CAAA;IAEnE,OAAO,cAAc;SAClB,MAAM,CAAC,QAAQ,CAAC,aAAa,EAAE,gBAAgB,CAAC,CAAC;SACjD,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC;SAC5C,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAC,CAAA;AACnD,CAAC;AAED,SAAS,QAAQ,CAAC,QAA8B,EAAE,IAAY,EAAE,WAAW,GAAG,KAAK;IACjF,OAAO,CAAC,EAAC,GAAG,EAAW,EAAE,EAAE;QACzB,IAAI,CAAC,QAAQ;YAAE,OAAO,IAAI,CAAA;QAE1B,MAAM,KAAK,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAA;QAC5D,MAAM,YAAY,GAAG,WAAW,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,KAAK,CAAA;QAEjD,IAAI,YAAY,EAAE;YAChB,WAAW,CAAC,uBAAuB,GAAG,QAAQ,IAAI,KAAK,CAAC,CAAA;YACxD,OAAO,KAAK,CAAA;SACb;QAED,OAAO,IAAI,CAAA;IACb,CAAC,CAAA;AACH,CAAC;AAED,KAAK,UAAU,sBAAsB,CAAC,EAAC,IAAI,EAAkB;IAC3D,MAAM,iBAAiB,GAAG,QAAQ,CAAC,IAAI,EAAE,cAAc,CAAC,CAAA;IAExD,MAAM,mBAAmB,GAAG,MAAM,UAAU,CAAC,iBAAiB,CAAC,CAAA;IAC/D,IAAI,CAAC,mBAAmB;QAAE,OAAO,EAAE,CAAA;IAEnC,MAAM,OAAO,GAAG,MAAM,QAAQ,CAAC,iBAAiB,EAAE,EAAC,QAAQ,EAAE,MAAM,EAAC,CAAC,CAAA;IAErE,OAAO,OAAO;SACX,KAAK,CAAC,cAAc,CAAC;SACrB,GAAG,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;SAC1B,MAAM,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CAAA;AACpD,CAAC","sourcesContent":["import {fileExists, readFile} from '@shopify/cli-kit/node/fs'\nimport {outputDebug} from '@shopify/cli-kit/node/output'\nimport {joinPath} from '@shopify/cli-kit/node/path'\nimport {Checksum, ThemeFileSystem} from '@shopify/cli-kit/node/themes/types'\n\nconst SHOPIFY_IGNORE = '.shopifyignore'\n\nexport async function applyIgnoreFilters(\n  themeChecksums: Checksum[],\n  themeFileSystem: ThemeFileSystem,\n  options: {ignore?: string[]; only?: string[]} = {},\n) {\n  const shopifyIgnore = await shopifyIgnoredPatterns(themeFileSystem)\n\n  return themeChecksums\n    .filter(filterBy(shopifyIgnore, '.shopifyignore'))\n    .filter(filterBy(options.ignore, '--ignore'))\n    .filter(filterBy(options.only, '--only', true))\n}\n\nfunction filterBy(patterns: string[] | undefined, type: string, invertMatch = false) {\n  return ({key}: Checksum) => {\n    if (!patterns) return true\n\n    const match = patterns.some((pattern) => key.match(pattern))\n    const shouldIgnore = invertMatch ? !match : match\n\n    if (shouldIgnore) {\n      outputDebug(`Ignoring theme file ${key} via ${type}...`)\n      return false\n    }\n\n    return true\n  }\n}\n\nasync function shopifyIgnoredPatterns({root}: ThemeFileSystem) {\n  const shopifyIgnorePath = joinPath(root, SHOPIFY_IGNORE)\n\n  const shopifyIgnoreExists = await fileExists(shopifyIgnorePath)\n  if (!shopifyIgnoreExists) return []\n\n  const content = await readFile(shopifyIgnorePath, {encoding: 'utf8'})\n\n  return content\n    .split(/(\\r\\n|\\r|\\n)/)\n    .map((line) => line.trim())\n    .filter((line) => line && !line.startsWith('#'))\n}\n"]}